# üï∑Ô∏è notabug-parser

> –°—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –∏–∑ –∞—Ä—Ö–∏–≤–æ–≤ ‚Äî –≤–æ—Å–∫—Ä–µ—à—ë–Ω –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Scrapy.  

> –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ—à–µ–Ω–∏—é –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∫ `xpath`, —Ç–∞–∫ –∏ `css`, —Ä—É—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –∏ `ItemLoader`, –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –∏ `callback`-–ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö). –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ ‚Äî —á—Ç–æ–±—ã –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫–∞—Ö, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö Scrapy.

> –ü–∞—Ä—Å–∏—Ç –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ [NotABug.org](https://notabug.org) ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `JSON Lines` —Ñ–æ—Ä–º–∞—Ç–µ.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### Poetry

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
poetry install --no-root

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd notabug

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä
poetry run scrapy crawl notabug
```

### pip

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv .venv

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –µ–≥–æ
source .venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd notaubg

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä
scrapy crawl notabug
```

–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä—ë—Ö —Ñ–∞–π–ª–∞—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ **JSONL** (JSON Lines):

- `accounts.jsonl` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- `organizations.jsonl` ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏  
- `repos.jsonl` ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

> üí° –§–æ—Ä–º–∞—Ç JSONL –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç—Ä–æ—á–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `jq`, Pandas –∏–ª–∏ Spark).

---

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### `AccountItem`
```json
{
  "url": "https://notabug.org/vimuser",
  "username": "vimuser",
  "avatar": "https://seccdn.libravatar.org/avatar/...",
  "joined": "2017-03-24 00:00:00",
  "link": "https://libreboot.org/",
  "location": "IRC",
  "followers": 40,
  "following": 4
}
```

### `OrganizationItem`
```json
{
  "url": "https://notabug.org/libreboot",
  "name": "libreboot",
  "joined": "2017-03-24 00:00:00",
  "icon": "https://seccdn.libravatar.org/avatar/...",
  "description": "Free (as in freedom) boot firmware...",
  "link": "https://libreboot.org",
  "location": null,
  "persons": ["/vimuser", "/leah"]
}
```

### `RepositoryItem`
```json
{
  "url": "https://notabug.org/jadedctrl/wrdk",
  "owner": "jadedctrl",
  "title": "wrdk",
  "last_updated": "2020-05-31 07:09:50",
  "stars": 0,
  "branches": 0,
  "description": "Mirror of the WikiReader Development Kits repository",
  "commits": 1,
  "releases": 0,
  "issues": 0,
  "pulls": 0,
  "forks": 0,
  "watchers": 0
}
```

> ‚ö†Ô∏è –í—Å–µ –¥–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–ø–∞—Ä—Å—è—Ç—Å—è –≤ `datetime`** –∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è.  

> –ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è (`stars`, `followers` –∏ —Ç.–¥.) ‚Äî **—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª–∏ —Å—Ç—Ä–æ–∫–∞–º–∏.

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∏–¥–∞** –≤ `settings.py`:

```python
from .items import AccountItem, RepositoryItem, OrganizationItem

FEEDS = {
    "accounts.jsonl": {
        "format": "jsonl", 
        "overwrite": False, 
        "item_classes": [AccountItem]
    },
    "repos.jsonl": {
        "format": "jsonl", 
        "item_classes": [RepositoryItem]
    },
    "organizations.jsonl": {
        "format": "jsonl", 
        "item_classes": [OrganizationItem]
    }
}
```

–ú–æ–∂–Ω–æ —Ä–∞—Å—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Å JOBDIR, –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –ø–æ—Å–ª–µ –µ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:
```python
JOBDIR = 'crawl-job/'
```

–ò –≤–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª:
```python
LOG_FILE = "crawl.log"
```

–¢–∞–∫–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–ª—è:
- –æ—á–∏—Å—Ç–∫–∏ —Å—Ç—Ä–æ–∫ (`StripStringsPipeline`)
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞—Ç (`JoinedCleanPipeline`)
- –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ (`ConvertToCorrectTypesPipeline`)

---

### üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ `notabug/notabug/settings.py`:

```python
PROXY_POOL_ENABLED = True
```

–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ `DOWNLOADER_MIDDLEWARES`:

```python
DOWNLOADER_MIDDLEWARES = {
    # ...
    'scrapy_proxy_pool.middlewares.ProxyPoolMiddleware': 610,
    'scrapy_proxy_pool.middlewares.BanDetectionMiddleware': 620,
    # ...
}
```

> üí° –≠—Ç–æ –ø–æ–¥–∫–ª—é—á–∏—Ç [scrapy-proxy-pool](https://github.com/rejoiceinhope/scrapy-proxy-pool ) ‚Äî middleware, –∫–æ—Ç–æ—Ä–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–æ—Ç–∏—Ä—É–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –∏–∑ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤.  

> –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —á–∞—Å—Ç–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ IP.

> üîí NotABug.org –Ω–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–æ–≤, –Ω–æ –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ –ø—Ä–æ–∫—Å–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
notabug/
‚îú‚îÄ‚îÄ scrapy.cfg
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ notabug/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ items.py          # dataclass-–º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ pipelines.py      # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îî‚îÄ‚îÄ spiders/
‚îÇ       ‚îî‚îÄ‚îÄ notabug.py    # –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∞–π–¥–µ—Ä
‚îú‚îÄ‚îÄ accounts.jsonl        # ‚Üê —Ä–µ–∑—É–ª—å—Ç–∞—Ç
‚îú‚îÄ‚îÄ organizations.jsonl   # ‚Üê —Ä–µ–∑—É–ª—å—Ç–∞—Ç
‚îî‚îÄ‚îÄ repos.jsonl           # ‚Üê —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

---

> ‚ö†Ô∏è –î–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö/–∞—Ä—Ö–∏–≤–Ω—ã—Ö —Ü–µ–ª–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

---
